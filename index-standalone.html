<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¤§é‡å°èªåå§“æœæ£</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      @font-face {
        font-family: "TASA Orbiter";
        src: url("TASAOrbiter[wght].woff2") format("woff2");
        font-weight: 100 900;
        font-style: normal;
        font-display: swap;
      }

      body {
        font-family: "TASA Orbiter", "Microsoft JhengHei", "PingFang TC", Arial,
          sans-serif;
        background: #f5f5f5;
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        border: 1px solid #e0e0e0;
      }

      .header {
        background: #2c3e50;
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.2em;
        margin-bottom: 10px;
        font-weight: 400;
      }

      .header p {
        font-size: 1em;
        opacity: 0.8;
      }

      .content {
        padding: 40px;
      }

      .input-section {
        margin-bottom: 40px;
      }

      .input-section h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.5em;
        font-weight: 500;
      }

      .input-area {
        width: 100%;
        min-height: 200px;
        padding: 15px;
        border: 2px solid #e1e5e9;
        border-radius: 10px;
        font-size: 16px;
        font-family: inherit;
        resize: vertical;
        transition: border-color 0.3s ease;
      }

      .input-area:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
      }

      .button-group {
        display: flex;
        gap: 15px;
        margin: 20px 0;
        flex-wrap: wrap;
      }

      .btn {
        padding: 12px 30px;
        border: none;
        border-radius: 25px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: inherit;
      }

      .btn-primary {
        background: #3498db;
        color: white;
        border: 1px solid #3498db;
      }

      .btn-primary:hover {
        background: #2980b9;
        border-color: #2980b9;
      }

      .btn-secondary {
        background: #ecf0f1;
        color: #2c3e50;
        border: 1px solid #bdc3c7;
      }

      .btn-secondary:hover {
        background: #d5dbdb;
        border-color: #95a5a6;
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
        box-shadow: none !important;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .result-section {
        margin-top: 40px;
      }

      .result-section h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.5em;
        font-weight: 500;
      }

      .spreadsheet-container {
        background: white;
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        border: 1px solid #d5dbdb;
      }

      .result-header {
        background: #34495e;
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .result-title {
        font-size: 1.2em;
        font-weight: 500;
      }

      .copy-table-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease;
        background: rgba(255, 255, 255, 0.15);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .copy-table-btn:hover {
        background: rgba(255, 255, 255, 0.25);
        border-color: rgba(255, 255, 255, 0.4);
      }

      .spreadsheet-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 16px;
        table-layout: auto;
      }

      .spreadsheet-table th {
        background: #f8f9fa;
        color: #495057;
        padding: 12px 8px;
        text-align: left;
        font-weight: 600;
        border-right: 1px solid #dee2e6;
        border-bottom: 2px solid #dee2e6;
        position: sticky;
        top: 0;
        z-index: 10;
        white-space: nowrap;
      }

      .spreadsheet-table td {
        padding: 10px 8px;
        border-right: 1px solid #dee2e6;
        border-bottom: 1px solid #dee2e6;
        vertical-align: top;
        white-space: nowrap;
        overflow: hidden;
      }

      .spreadsheet-table tr:hover {
        background-color: #f8f9fa;
      }

      .name-cell {
        font-weight: 600;
        color: #2c3e50;
        min-width: 80px;
      }

      .pronunciation-cell {
        color: #c0392b;
        line-height: 1.4;
        text-align: center;
        min-width: 100px;
      }

      .table-container {
        max-height: 600px;
        overflow: auto;
        border: 1px solid #dee2e6;
        min-width: 100%;
      }

      .error-message {
        background: #fdf2f2;
        color: #e53e3e;
        padding: 15px;
        border-radius: 6px;
        margin: 20px 0;
        border: 1px solid #feb2b2;
        border-left: 4px solid #e53e3e;
      }

      .success-message {
        background: #f0fff4;
        color: #2f855a;
        padding: 15px;
        border-radius: 6px;
        margin: 20px 0;
        border: 1px solid #9ae6b4;
        border-left: 4px solid #27ae60;
      }

      .stats {
        display: flex;
        gap: 20px;
        margin: 20px 0;
        flex-wrap: wrap;
      }

      .stat-item {
        background: #f8f9fa;
        padding: 15px 20px;
        border-radius: 6px;
        text-align: center;
        flex: 1;
        min-width: 150px;
        border: 1px solid #e9ecef;
      }

      .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #3498db;
        display: block;
      }

      .stat-label {
        color: #6c757d;
        font-size: 0.9em;
        margin-top: 5px;
      }

      .info-box {
        background: #f0f8ff;
        border: 1px solid #b3d9ff;
        border-radius: 6px;
        padding: 15px;
        margin: 20px 0;
        color: #2c3e50;
      }

      .footer {
        background: transparent;
        color: #6c757d;
        padding: 30px 20px;
        text-align: center;
        margin-top: 40px;
        border-top: 1px solid #e0e0e0;
      }

      .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .footer-item {
        font-size: 0.9em;
        color: #6c757d;
      }

      .footer-item strong {
        font-weight: 500;
        margin-right: 5px;
        color: #495057;
      }

      .footer-link {
        color: #3498db;
        text-decoration: none;
        transition: color 0.3s ease;
      }

      .footer-link:hover {
        color: #2980b9;
        text-decoration: underline;
      }

      @media (max-width: 768px) {
        .container {
          margin: 10px;
          border-radius: 10px;
        }

        .content {
          padding: 20px;
        }

        .header {
          padding: 20px;
        }

        .header h1 {
          font-size: 2em;
        }

        .button-group {
          flex-direction: column;
        }

        .btn {
          width: 100%;
        }

        .spreadsheet-header {
          flex-direction: column;
          gap: 15px;
          align-items: stretch;
        }

        .spreadsheet-controls {
          justify-content: center;
        }

        .export-section {
          flex-direction: column;
          align-items: stretch;
        }

        .export-btn {
          width: 100%;
          margin-bottom: 10px;
        }

        .table-container {
          max-height: 400px;
        }

        .spreadsheet-table {
          font-size: 12px;
        }

        .spreadsheet-table th,
        .spreadsheet-table td {
          padding: 8px 6px;
        }

        .pronunciation-cell {
          min-width: 60px;
          font-size: 11px;
        }

        .name-cell {
          min-width: 60px;
        }

        .footer {
          padding: 20px 15px;
          margin-top: 30px;
        }

        .footer-item {
          font-size: 0.85em;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>å¤§é‡å°èªåå§“æœæ£</h1>
        <p>è¼¸å…¥åå§“ã€å°±æœƒç•¶é–£khÃ³o-phihè‡³è¡¨æ ¼è»Ÿé«”é€²ä¸€æ­¥ç·¨è¼¯å–”ï¼</p>
      </div>

      <div class="content">
        <div class="input-section">
          <h2>è¼¸å…¥åå§“</h2>
          <textarea
            id="nameInput"
            class="input-area"
            placeholder="è«‹ä½‡é®è¼¸å…¥æ¬²æœæ£çš„åå§“ï¼Œé€é€ä¸€ä¸ªåå§“&#10;è¦‹æœ¬ï¼š&#10;è”£æ¸­æ°´&#10;å»–æ·»ä¸&#10;é»ƒåœŸæ°´"
          ></textarea>

          <div class="button-group">
            <button id="processBtn" class="btn btn-primary">ğŸ” æœæ£</button>
            <button id="clearBtn" class="btn btn-secondary">ğŸ—‘ï¸ æŒ•æ’</button>
            <button id="loadSampleBtn" class="btn btn-secondary">
              ğŸ“ è¦‹æœ¬
            </button>
          </div>

          <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>ç•¶å’§è™•ç†ï¼Œå°ç­‰ä¸€ä¸‹...</p>
          </div>
        </div>

        <div id="statsSection" class="stats" style="display: none">
          <div class="stat-item">
            <span class="stat-number" id="totalNames">0</span>
            <div class="stat-label">ä¸ªåå§“</div>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="totalPronunciations">0</span>
            <div class="stat-label">ä¸ªè®€éŸ³</div>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="processingTime">0</span>
            <div class="stat-label">è™•ç†æ™‚é–“(ç§’)</div>
          </div>
        </div>

        <div class="result-section" id="resultSection" style="display: none">
          <h2>æœæ£çµæœ</h2>
          <div class="spreadsheet-container">
            <div class="result-header">
              <div class="result-title">æœæ£çµæœ</div>
              <button class="copy-table-btn" id="copyTableBtn">Copy</button>
            </div>
            <div class="table-container">
              <table class="spreadsheet-table" id="resultTable">
                <!-- è¡¨æ ¼å…§å®¹å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="footer-content">
        <div class="footer-item">
          <strong>ç¶²é ä½œè€…ï¼š</strong>
          <a
            href="https://kiantiong.com/"
            target="_blank"
            rel="noopener noreferrer"
            class="footer-link"
            >TÃ¢n KiÃ n-tiong</a
          >
        </div>
        <div class="footer-item">
          <strong>åå§“è³‡æ–™ä¾†æºï¼š</strong>
          <a
            href="https://sutian.moe.edu.tw/und-hani/"
            target="_blank"
            rel="noopener noreferrer"
            class="footer-link"
            >æ•™è‚²éƒ¨è‡ºç£å°èªå¸¸ç”¨è©è¾­å…¸</a
          >
        </div>
      </div>
    </footer>

    <!-- å…§åµŒè³‡æ–™ -->
    <script src="embedded-data.js"></script>

    <!-- æ‡‰ç”¨ç¨‹å¼é‚è¼¯ -->
    <script>
      // è³‡æ–™è¼‰å…¥å’Œè™•ç†æ¨¡çµ„
      class DataLoader {
        constructor() {
          this.surnameData = null;
          this.givenNameData = null;
          this.compoundSurnameData = null;
          this.isLoaded = false;
          this.useEmbeddedData = false;
        }

        // è¼‰å…¥æ‰€æœ‰è³‡æ–™
        async loadAllData() {
          try {
            console.log("é–‹å§‹è¼‰å…¥è³‡æ–™...");

            // ä½¿ç”¨å…§åµŒè³‡æ–™
            if (window.embeddedData) {
              this.surnameData = window.embeddedData.surname;
              this.givenNameData = window.embeddedData.givenName;
              this.compoundSurnameData = window.embeddedData.compoundSurname;
              this.useEmbeddedData = true;
              console.log("è³‡æ–™è¼‰å…¥å®Œæˆ");
            } else {
              throw new Error("è³‡æ–™ç„¡å»çŸ£");
            }

            this.isLoaded = true;
            console.log(`å§“: ${Object.keys(this.surnameData).length} ç­†`);
            console.log(`å: ${Object.keys(this.givenNameData).length} ç­†`);
            console.log(
              `è¤‡å§“: ${Object.keys(this.compoundSurnameData).length} ç­†`
            );

            return true;
          } catch (error) {
            console.error("è¼‰å…¥è³‡æ–™æ‹„è‘—éŒ¯èª¤:", error);
            throw error;
          }
        }

        // å–å¾—å§“æ°çš„å”¯ä¸€æ¼¢å­—åˆ—è¡¨
        getSurnameChars() {
          return Object.keys(this.surnameData || {});
        }

        // å–å¾—è¤‡å§“åˆ—è¡¨
        getCompoundSurnames() {
          return Object.keys(this.compoundSurnameData || {});
        }

        // åŒ¹é…æ¼¢å­—è®€éŸ³
        matchCharacter(char, dataType) {
          let data;
          switch (dataType) {
            case "surname":
              data = this.surnameData;
              break;
            case "givenName":
              data = this.givenNameData;
              break;
            case "compoundSurname":
              data = this.compoundSurnameData;
              break;
            default:
              return [];
          }

          if (!data || !data[char]) {
            return [];
          }

          return data[char].map((item) => item.lo);
        }
      }

      // åå§“å°èªè®€éŸ³æŸ¥è©¢ä¸»ç¨‹å¼
      class NamePronunciationApp {
        constructor() {
          this.init();
        }

        init() {
          this.bindEvents();
          this.loadData();
        }

        // ç¶å®šäº‹ä»¶
        bindEvents() {
          document
            .getElementById("processBtn")
            .addEventListener("click", () => this.processNames());
          document
            .getElementById("clearBtn")
            .addEventListener("click", () => this.clearResults());
          document
            .getElementById("loadSampleBtn")
            .addEventListener("click", () => this.loadSample());

          // è¤‡è£½è¡¨æ ¼æŒ‰éˆ•
          document
            .getElementById("copyTableBtn")
            .addEventListener("click", () => this.copyTable());
        }

        // è¼‰å…¥è³‡æ–™
        async loadData() {
          try {
            const loadingElement = document.getElementById("loading");
            loadingElement.style.display = "block";

            await window.dataLoader.loadAllData();

            loadingElement.style.display = "none";
          } catch (error) {
            document.getElementById("loading").style.display = "none";
            this.showErrorMessage(`è¼‰å…¥è³‡æ–™å¤±æ•—: ${error.message}`);
          }
        }

        // è™•ç†åå§“æŸ¥è©¢
        async processNames() {
          const nameInput = document.getElementById("nameInput").value.trim();

          if (!nameInput) {
            this.showErrorMessage("è«‹è¼¸å…¥ä½ æ¬²æ£çš„åå§“");
            return;
          }

          if (!window.dataLoader.isLoaded) {
            this.showErrorMessage("è³‡æ–™çŒ¶é–£å’§lÃ³o-tÃ¬ngï¼Œå°ç­‰ä¸€ä¸‹...");
            return;
          }

          try {
            const startTime = performance.now();

            // é¡¯ç¤ºè¼‰å…¥ä¸­
            this.showLoading(true);

            // åˆ†å‰²åå§“
            const nameList = nameInput
              .split("\n")
              .map((name) => name.trim())
              .filter((name) => name.length > 0);

            // æª¢æŸ¥åå§“é•·åº¦é™åˆ¶
            for (const name of nameList) {
              if (Array.from(name).length > 5) {
                this.showLoading(false);
                this.showErrorMessage(`åå§“ã€Œ${name}ã€æ¥µåŠ äº”å­—ï¼Œè«‹é‡æ–°è¼¸å…¥`);
                return;
              }
            }

            const results = [];
            for (const name of nameList) {
              const pronunciations = this.processName(name);
              results.push({
                name: name,
                pronunciations: pronunciations,
              });
            }

            const endTime = performance.now();
            const processingTime = ((endTime - startTime) / 1000).toFixed(3);

            // é¡¯ç¤ºçµæœ
            this.displayResults(results, processingTime);

            this.showLoading(false);
          } catch (error) {
            this.showLoading(false);
            this.showErrorMessage(`è™•ç†éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤: ${error.message}`);
          }
        }

        // è™•ç†å–®å€‹åå§“
        processName(name) {
          // åˆ†æå§“å’Œå
          const nameAnalysis = this.analyzeName(name);
          const { surname, givenName, isCompoundSurname } = nameAnalysis;

          // å–å¾—å§“æ°è®€éŸ³
          const surnamePronunciations = [];
          if (isCompoundSurname) {
            // è¤‡å§“
            const compoundPronunciations = window.dataLoader.matchCharacter(
              surname,
              "compoundSurname"
            );
            surnamePronunciations.push(...compoundPronunciations);
          } else {
            // å–®å§“æˆ–å¤šå­—å§“
            const surnameChars = this.splitUnicodeChars(surname);
            const surnameCharPronunciations = surnameChars.map((char) => {
              const surnameMatches = window.dataLoader.matchCharacter(
                char,
                "surname"
              );

              if (surnameMatches.length > 0) {
                return surnameMatches;
              }

              const givenNameMatches = window.dataLoader.matchCharacter(
                char,
                "givenName"
              );

              if (givenNameMatches.length > 0) {
                return givenNameMatches;
              }

              // ä¿åº•ï¼šè‹¥ç„¡è®€éŸ³è³‡æ–™ï¼Œç›´æ¥å›å‚³åŸå­—ï¼Œæ¯‹å…äºˆè®€éŸ³çµ„åˆè®Šåšç©ºçš„
              return [char];
            });
            surnamePronunciations.push(
              ...this.combinePronunciations(surnameCharPronunciations, "-")
            );
          }

          // å–å¾—åå­—è®€éŸ³
          const givenNameChars = this.splitUnicodeChars(givenName);
          const givenNameCharPronunciations = givenNameChars.map((char) =>
            window.dataLoader.matchCharacter(char, "givenName")
          );
          const givenNamePronunciations = this.combinePronunciations(
            givenNameCharPronunciations,
            "-"
          );

          // çµ„åˆå§“å’Œåçš„è®€éŸ³
          const allPronunciations = [];
          if (surnamePronunciations.length === 0) {
            // åªæœ‰åï¼Œæ²’æœ‰å§“
            allPronunciations.push(
              ...givenNamePronunciations.map((pron) =>
                this.capitalizeGivenName(pron)
              )
            );
          } else {
            // æœ‰å§“å’Œå
            const combinedPronunciations = this.combinePronunciations(
              [surnamePronunciations, givenNamePronunciations],
              " "
            );
            allPronunciations.push(
              ...combinedPronunciations.map((pron) =>
                this.capitalizeGivenName(pron)
              )
            );
          }

          // é™åˆ¶æœ€å¤š100ç¨®è®€éŸ³çµ„åˆ
          return allPronunciations.slice(0, 100);
        }

        // åˆ†æåå§“çµæ§‹
        analyzeName(name) {
          const nameChars = this.splitUnicodeChars(name);

          if (nameChars.length === 0) {
            return { surname: "", givenName: name, isCompoundSurname: false };
          }

          // æª¢æŸ¥æ˜¯å¦ç‚ºè¤‡å§“ï¼ˆå‰å…©å€‹å­—ï¼‰
          if (nameChars.length >= 2) {
            const firstTwoChars = nameChars.slice(0, 2).join("");
            const compoundSurnames = window.dataLoader.getCompoundSurnames();

            for (const compoundSurname of compoundSurnames) {
              if (compoundSurname === firstTwoChars) {
                return {
                  surname: firstTwoChars,
                  givenName: nameChars.slice(2).join(""),
                  isCompoundSurname: true,
                };
              }
            }
          }

          // æª¢æŸ¥æ˜¯å¦ç‚ºé•·åå§“ï¼ˆè¶…é3å€‹å­—ï¼‰ï¼Œå¯èƒ½æ˜¯è¤‡åˆå§“
          if (nameChars.length > 3) {
            const firstTwoChars = nameChars.slice(0, 2).join("");
            return {
              surname: firstTwoChars,
              givenName: nameChars.slice(2).join(""),
              isCompoundSurname: false,
            };
          }

          // ä¸€èˆ¬æƒ…æ³ï¼šç¬¬ä¸€å€‹å­—ç‚ºå§“
          const firstChar = nameChars[0];
          const surnames = window.dataLoader.getSurnameChars();

          for (const surname of surnames) {
            if (surname === firstChar) {
              return {
                surname: firstChar,
                givenName: nameChars.slice(1).join(""),
                isCompoundSurname: false,
              };
            }
          }

          // æ‰¾ä¸åˆ°å°æ‡‰çš„å§“ï¼Œæ•´å€‹ç•¶ä½œå
          return {
            surname: "",
            givenName: name,
            isCompoundSurname: false,
          };
        }

        // Unicode å®‰å…¨çš„å­—ç¬¦åˆ†å‰²
        splitUnicodeChars(str) {
          return Array.from(str);
        }

        // çµ„åˆè®€éŸ³
        combinePronunciations(nestedArray, separator) {
          if (!nestedArray.length) {
            return [];
          }

          const result = [];

          function combineInternal(index, current) {
            if (index === nestedArray.length) {
              result.push(current.join(separator));
              return;
            }

            for (const item of nestedArray[index]) {
              combineInternal(index + 1, current.concat(item));
            }
          }

          combineInternal(0, []);
          return result;
        }

        // é¦–å­—æ¯å¤§å¯«
        capitalizeFirst(str) {
          if (!str) return str;
          return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // å°ç¾…åå§“è¦å‰‡ï¼šåçš„é¦–å­—æ¯å¤§å¯«
        capitalizeGivenName(str) {
          if (!str) return str;

          // å¦‚æœæœ‰ç©ºæ ¼åˆ†éš”ï¼ˆå§“å’Œåï¼‰ï¼Œåªå°åçš„éƒ¨åˆ†é¦–å­—æ¯å¤§å¯«
          if (str.includes(" ")) {
            const parts = str.split(" ");
            if (parts.length === 2) {
              // å§“æ°éƒ¨åˆ†ä¿æŒåŸæ¨£ï¼Œåå­—éƒ¨åˆ†é¦–å­—æ¯å¤§å¯«
              return parts[0] + " " + this.capitalizeFirst(parts[1]);
            }
          }

          // å¦‚æœæ²’æœ‰ç©ºæ ¼ï¼Œæ•´å€‹å­—ä¸²é¦–å­—æ¯å¤§å¯«
          return this.capitalizeFirst(str);
        }

        // é¡¯ç¤ºçµæœ
        displayResults(results, processingTime) {
          const resultSection = document.getElementById("resultSection");
          const resultTable = document.getElementById("resultTable");
          const statsSection = document.getElementById("statsSection");

          // è¨ˆç®—çµ±è¨ˆè³‡æ–™
          const totalNames = results.length;
          const totalPronunciations = results.reduce(
            (sum, result) => sum + result.pronunciations.length,
            0
          );

          // æ›´æ–°çµ±è¨ˆ
          document.getElementById("totalNames").textContent = totalNames;
          document.getElementById("totalPronunciations").textContent =
            totalPronunciations;
          document.getElementById("processingTime").textContent =
            processingTime;

          // å„²å­˜çµæœè³‡æ–™
          this.currentResults = results;

          // å»ºç«‹è©¦ç®—è¡¨æ ¼å¼çš„è¡¨æ ¼
          this.buildSpreadsheetTable(results);

          // é¡¯ç¤ºçµæœå€å¡Š
          resultSection.style.display = "block";
          statsSection.style.display = "flex";

          this.showSuccessMessage(
            `æœæ£å®Œæˆï¼æ”ç¸½è™•ç† ${totalNames} ä¸ªåå§“ï¼Œæœ‰ ${totalPronunciations} ä¸ªè®€éŸ³çµ„åˆ`
          );
        }

        // å»ºç«‹ç°¡åŒ–çš„è¡¨æ ¼
        buildSpreadsheetTable(results) {
          const table = document.getElementById("resultTable");
          table.innerHTML = "";

          // è¨ˆç®—æœ€å¤§è®€éŸ³æ•¸é‡ï¼Œæ±ºå®šéœ€è¦å¤šå°‘æ¬„ä½
          const maxPronunciations = Math.max(
            ...results.map((result) => result.pronunciations.length)
          );

          // å»ºç«‹è¡¨é ­
          const thead = document.createElement("thead");
          const headerRow = document.createElement("tr");
          headerRow.innerHTML = `<th>åå§“</th>`;

          // å‹•æ…‹å»ºç«‹è®€éŸ³æ¬„ä½æ¨™é¡Œ
          for (let i = 0; i < maxPronunciations; i++) {
            headerRow.innerHTML += `<th>è®€éŸ³${i + 1}</th>`;
          }

          thead.appendChild(headerRow);
          table.appendChild(thead);

          // å»ºç«‹è¡¨èº«
          const tbody = document.createElement("tbody");
          results.forEach((result) => {
            const row = document.createElement("tr");

            let rowHTML = `<td class="name-cell">${result.name}</td>`;

            // ç‚ºæ¯å€‹è®€éŸ³å»ºç«‹ç¨ç«‹çš„æ¬„ä½
            for (let i = 0; i < maxPronunciations; i++) {
              const pronunciation = result.pronunciations[i] || "";
              rowHTML += `<td class="pronunciation-cell">${pronunciation}</td>`;
            }

            row.innerHTML = rowHTML;
            tbody.appendChild(row);
          });
          table.appendChild(tbody);

          // å„²å­˜æ¬„ä½æ•¸é‡ä¾›è¤‡è£½åŠŸèƒ½ä½¿ç”¨
          this.maxPronunciations = maxPronunciations;
        }

        // æ¸…é™¤çµæœ
        clearResults() {
          document.getElementById("nameInput").value = "";
          document.getElementById("resultSection").style.display = "none";
          document.getElementById("statsSection").style.display = "none";
          document.getElementById("resultTable").innerHTML = "";
          this.clearMessages();
        }

        // è¤‡è£½è¡¨æ ¼
        copyTable() {
          if (!this.currentResults) {
            this.showErrorMessage("ä¸¦ç„¡è³‡æ–™é€šå¥½khÃ³o-phih");
            return;
          }

          const copyBtn = document.getElementById("copyTableBtn");
          const originalText = copyBtn ? copyBtn.textContent : "";

          if (copyBtn) {
            copyBtn.disabled = true;
            copyBtn.textContent = "Copied";
          }

          const data = this.currentResults.map(
            (result) => `${result.name}\t${result.pronunciations.join("\t")}`
          );
          const text = data.join("\n");

          navigator.clipboard
            .writeText(text)
            .then(() => {
              this.showSuccessMessage(
                `å·²ç¶“å…±è¡¨æ ¼çš„è³‡æ–™ khÃ³o-phih è‡³å‰ªè²¼ç°¿ï¼Œæ”ç¸½æœ‰ ${this.currentResults.length} æ¢`
              );
            })
            .catch((err) => {
              console.error("è¤‡è£½å¤±æ•—:", err);
              this.showErrorMessage("khÃ³o-phihå¤±æ•—");
            })
            .finally(() => {
              if (copyBtn) {
                setTimeout(() => {
                  copyBtn.disabled = false;
                  copyBtn.textContent = originalText;
                }, 1000);
              }
            });
        }

        // è¼‰å…¥ç¯„ä¾‹
        loadSample() {
          const sampleNames = `é™³æ™¨å¨
æ—ç«‹
é™³å‚‘æ†²
æ—å®‰å¯
æ½˜å‚‘æ¥·
æ±Ÿå¤å®‡
å²³æ±è¯
æ—å®¶æ­£
å¼µæ”¿ç¦¹
æ—æ˜±ç‰
`;
          document.getElementById("nameInput").value = sampleNames;
        }

        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        showLoading(show) {
          const loadingElement = document.getElementById("loading");
          const processBtn = document.getElementById("processBtn");

          if (show) {
            loadingElement.style.display = "block";
            processBtn.disabled = true;
          } else {
            loadingElement.style.display = "none";
            processBtn.disabled = false;
          }
        }

        // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
        showSuccessMessage(message) {
          this.clearMessages();
          const messageDiv = document.createElement("div");
          messageDiv.className = "success-message";
          messageDiv.textContent = message;
          document.querySelector(".input-section").appendChild(messageDiv);
        }

        // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
        showErrorMessage(message) {
          this.clearMessages();
          const messageDiv = document.createElement("div");
          messageDiv.className = "error-message";
          messageDiv.textContent = message;
          document.querySelector(".input-section").appendChild(messageDiv);
        }

        // æ¸…é™¤è¨Šæ¯
        clearMessages() {
          const messages = document.querySelectorAll(
            ".success-message, .error-message"
          );
          messages.forEach((msg) => msg.remove());
        }
      }

      // å…¨åŸŸè³‡æ–™è¼‰å…¥å™¨å¯¦ä¾‹
      window.dataLoader = new DataLoader();

      // ç•¶é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
      document.addEventListener("DOMContentLoaded", () => {
        window.nameApp = new NamePronunciationApp();
      });
    </script>
  </body>
</html>
